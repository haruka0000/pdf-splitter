<html>
<head>
    <meta charset="UTF-8">
    <title>PDF-Splitter</title>
    <link rel="stylesheet" type="text/css" href="css/my_style.css">
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,300,400,700,900|Oswald:400,700"> -->
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/mediaelementplayer.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="css/fl-bigmug-line.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!--テーブル生成位置-->
    <div id="container">
        <div id="top-area">
            <button id="pdf_path" name="pdf_path" class="btn btn-white" onclick="getFolder()">Import PDF</button>
            <label id="pdf-path-disp" ></label>
        </div>
        <div id="table-area">
            <table id='maintable'>
                <!-- <thead></thead><tbody></tbody> -->
            </table>
        </div>
        <div id="bottom_area">
            <button id="submit_btn" name="submit_btn" class="btn btn-primary" onclick="submit_table()">commit</button>
            <label class="label" style="padding-left: 30px;">Prefix:</label>
            <input type="text" class="search-input" style="width: 200px;"></input>
            <label class="label" style="padding-left: 2px;">ex.) [prefix]-[01]-[title].pdf</label>
        </div>
    </div>
    <!-- Python用 -->
    <script type="text/javascript" src="/eel.js"></script>
    
    <script type="text/javascript">
        var pdf_path = "";
        var table = document.getElementById('maintable');
        async function run() {
            let data = await eel.get_table_data(pdf_path)();
            set_data(data);
        }

        function set_data(data){
            for (var i = 0; i < 5; i++) {
                data.push(["", "" ,""])
            }
            table.innerHTML = ''
            var thead = document.createElement('thead');
            var tbody = document.createElement('tbody');
            table.appendChild(thead);
            table.appendChild(tbody);
            // tr部分のループ
            for (var i = 0; i < data.length; i++) {
                // tr要素を生成
                var tr = document.createElement('tr');
                tr.name = "table_row"
                // th・td部分のループ
                for (var j = 0; j < data[i].length+1; j++) {
                    // 1行目のtr要素の時
                    if(i === 0) {
                        var th = document.createElement('th');
                        if (j == 0){
                            th.textContent = "";
                            th.style = "width: 30px;"
                        } else{
                            th.textContent = data[i][j-1];
                            if (j == 1){ th.classList.add('text-cell'); }else{ th.classList.add('number-cell'); }
                        }
                        tr.appendChild(th)
                    } else{
                        var td = document.createElement('td');
                        if (j === 0){
                            td.textContent = i;
                            td.style = "width: 30px; font-size: 24;"
                        } else{
                            var cell = document.createElement('input');
                            cell.classList.add('cellinputs', 'search-input');
                            if (j == 1){
                                cell.classList.add('text-cell');
                                td.classList.add('text-cell');
                            } else{
                                cell.classList.add('number-cell');
                                td.classList.add('number-cell');
                            }
                            cell.name = "table_cell"
                            if (data[i][j] != ""){
                                cell.value = data[i][j-1];
                            }
                            td.appendChild(cell)
                        }
                        tr.appendChild(td) 
                    }
                }
                // 1行目のtr要素の時
                if(i === 0) {
                    thead.appendChild(tr);
                } else{
                    tbody.appendChild(tr);
                }
            }
        }
        
        // SUBMITされたとき
        async function getFolder() {
            // ファイル入力
            pdf_path = await eel.btn_ResimyoluClick()();
            pdf_path_disp = document.getElementById("pdf-path-disp");
            pdf_path_disp.textContent = pdf_path;
            // 再描画
            run();
        }

        async function submit_table(){
            table_d = get_table_inputs();
            let data = await eel.update_data(table_d)();
            set_data(data);
        }

        function get_table_inputs(){
            var table = document.getElementById('maintable');
            var t_rows = table.getElementsByTagName('tr');
            var t_arr = [];
            // th の取得
            var th_row = t_rows[0].getElementsByTagName("th");
            var r_arr = [];
            for (var i = 1; i < th_row.length; i++) {
                r_arr.push(th_row[i].textContent);
            }
            t_arr.push(r_arr);
            // td の取得
            for (var i = 1; i < t_rows.length; i++) {
                var r_arr = [];
                var cells = t_rows[i].getElementsByTagName("input")
                for (var j = 0; j < cells.length; j++) {
                    r_arr.push(cells[j].value);
                }
                t_arr.push(r_arr);
            }
            return t_arr
        }
    </script>
</body>
</html>
